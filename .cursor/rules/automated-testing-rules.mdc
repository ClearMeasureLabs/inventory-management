---
description: Test requirements for all code changes
alwaysApply: true
---

# Automated Testing Requirements

All changes require passing tests. Verify with `scripts/build_and_test.ps1`.

## Test Types

### Unit Tests (.NET)
**Location:** `src/Tests/UnitTests/`

Isolated behavior with mocks. Cover:
- Dependencies called with correct parameters
- Business logic and data transformations
- State changes persisted correctly
- Return values (DTOs/responses)
- Exceptions for validation/edge cases

### Integration Tests (.NET)
**Location:** `src/Tests/IntegrationTests/`

Components with real infrastructure (Testcontainers). Cover happy path.

### Angular Tests
**Location:** Alongside components as `*.spec.ts`

UI behavior with Jasmine/Karma. Cover:
- Component rendering
- User interactions
- API integration (mock with `HttpTestingController`)
- Error handling
- State management

### Acceptance Tests (.NET)
**Location:** `src/Tests/AcceptanceTests/`

Full stack with Playwright. Deploy via Docker Compose, test at `localhost:4200` (WebApp) / `localhost:5000` (WebAPI).

Required for: User-facing features, critical workflows, production regressions.

## When Tests Are Required

| Change Type | Required Tests |
|-------------|----------------|
| Backend functionality | Unit + Integration |
| UI components | Angular |
| Bug fixes | Regression test at appropriate level |

## Guidelines

**.NET:** Use Arrange-Act-Assert, `#region` blocks for categories, Bogus for test data.

**Angular:** Use `fakeAsync`/`tick` for async, test success and error scenarios.

## Running Tests

```powershell
.\scripts\build_and_test.ps1           # All tests
dotnet test src/Tests/UnitTests        # Unit only
dotnet test src/Tests/IntegrationTests # Integration only
dotnet test src/Tests/AcceptanceTests  # Acceptance only (requires Docker)

# Angular only
cd src/Presentation/webapp
npm test -- --watch=false --browsers=ChromeHeadless
```
